function datapicker2(e){var v=$.extend({data:null,class:null,active_level:1,init_value:[],item_height:40,item_number:5,event_init:null,event_ok:null,event_cancel:null},e);("number"!==$.type(v.item_height)||v.item_height<=0)&&(v.item_height=40),"number"!==$.type(v.item_number)||v.item_number<3?v.number=1:0===Math.floor(v.item_number/2)&&(v.item_number=v.item_number-1),$.isArray(v.init_value)||(v.init_value=[v.init_value]);var s=[],c=[v.data];function d(e){var a=r.find(".pick-item-"+e.level);if(0<a.length)for(a.text(e.name).data("value",e.value),a=a.next(".pick-item");0<a.length;){var i=a.next();a.remove(),a=i,i=null}else r.append('<div class="pick-item pick-item-'+e.level+'" data-value="'+e.value+'" data-level="'+e.level+'">'+e.name+"</div>")}function u(e){var a="",i={value:0,name:"请选择",level:e.level};if(e.data)for(var l in e.data)e.value&&e.value==l?(i.value=l,i.name=e.data[l].name,a+='<a class="pick-item hover checked" href="javascript:;" data-value="'+l+'" style="height:'+v.item_height+'px">'+e.data[l].name+"</a>"):a+='<a class="pick-item hover" href="javascript:;" data-value="'+l+'" style="height:'+v.item_height+'px">'+e.data[l].name+"</a>";d(i);var t=o.find(".pick-list-"+e.level);return 0<t.length?t.html(a):o.append('<div class="pick-list pick-list-'+e.level+'" data-level="'+e.level+'">'+a+"</div>"),i}function i(){s=[];for(var e=v.data,a=-1,i=0;i<v.active_level&&v.init_value[i];i++){var l=u({data:e,level:i,value:v.init_value[i]});if(s[i]={name:l.name,value:l.value},!(c[i]=e)[v.init_value[i]]){e=null;break}e=e[v.init_value[i]].value,a=i}-1===a?(u({data:v.data,level:0}),a=0):a+1<v.active_level&&d({level:a+1,name:"请选择",value:0}),r.find(".pick-item").removeClass("checked").filter(".pick-item-"+a).addClass("checked");var t=o.find(".pick-list").removeClass("show");t=t.filter(".pick-list-"+a).addClass("show"),setTimeout(function(){var e=t.find(".pick-item.checked");0<e.length&&t.scrollTop(v.item_height*(e.index()-Math.floor(v.item_number/2)))},10)}var a=$('<a class="pick-close" href="javascript:;"></a>').on("click",function(){h.hide()}),r=$('<div class="pick-now"></div>').on("click",".pick-item",function(){var e=$(this),a=e.data("level");if(e.data("value"))if(a+1===v.active_level)$.isFunction(v.event_ok)&&v.event_ok(s),h.hide();else{e.addClass("checked");var i=o.find(".pick-list").removeClass("show").filter(".pick-list-"+a).addClass("show");0<(n=i.find('.pick-item[data-value="'+e.data("value")+'"]').addClass("checked")).length&&i.scrollTop(v.item_height*(n.index()-Math.floor(v.item_number/2)));var l=e.next(".pick-item");if(0<l.length)for(l.text("请选择").data("value",0).removeClass("checked"),l=l.next();0<l.length;){var t=l.next();l.remove(),l=t,t=null}l=null}else if(0<a){var n;0<(n=$(".pick-list-"+(a-1)+" .pick-item.checked")).length&&(s[a-1]={name:n.text(),value:n.data("value")},c[a]=c[a-1][n.data("value")].value,d({level:a,name:n.text(),value:n.data("value")}),u({data:c[a],level:a}),r.find(".pick-item").removeClass("checked").filter(".pick-item-"+a).addClass("checked"),o.find(".pick-list").removeClass("show").filter(".pick-list-"+a).addClass("show").scrollTop(0))}}),o=$('<div class="pick-main"></div>').css({height:v.item_height*v.item_number}).on("click",".pick-item",function(){var e=$(this),a=e.closest(".pick-list").data("level");s[a]={name:e.text(),value:e.data("value")},a+1<v.active_level?(e.addClass("checked").siblings().removeClass("checked"),c[a+1]=c[a][e.data("value")].value,d({level:a,name:e.text(),value:e.data("value")}),u({data:c[a+1],level:a+1}),r.find(".pick-item").removeClass("checked").filter(".pick-item-"+(a+1)).addClass("checked"),o.find(".pick-list").removeClass("show").filter(".pick-list-"+(a+1)).addClass("show").scrollTop(0)):($.isFunction(v.event_ok)&&v.event_ok(s),h.hide())}),l=$('<div class="pick-box"></div>').append(r.append(a),o),t=$('<div class="pick-bg"></div>').on("click",function(){h.hide()}).on("touchmove",function(e){e.preventDefault()}),n=$('<div class="pick-wrap"></div>').append(t,l),m=$('<div class="datapick2"></div>');v.class&&m.addClass(v.class),$.isFunction(v.event_init)&&(i(),v.event_init(s)),$("body").append(m.append(n));var h={show:function(e,a){(a||v.data)&&(a&&(v.data=a),e&&$.isArray(e)?v.init_value=e:e&&!$.isArray(e)?v.init_value=[e]:v.init_value=[null],i(),m.css("display","block"),setTimeout(function(){m.addClass("open")},50))},hide:function(){m.removeClass("open"),setTimeout(function(){m.css("display","none")},400)}};return h}