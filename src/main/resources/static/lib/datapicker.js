function datapicker(e){var d=$.extend({data:null,class:null,active_level:null,item_height:60,item_number:3,cover:!0,auto_fill_all:!1,fill_all_item:[{value:0,name:"全部"}],init_value:null,node:null,event_init:null,event_show:null,event_scroll:null,event_ok:null,event_cancel:null},e);("number"!==$.type(d.item_height)||d.item_height<=0)&&(d.item_height=60),"number"!==$.type(d.item_number)||d.item_number<3?d.number=1:0===Math.floor(d.item_number/2)&&(d.item_number=d.item_number-1),$.isArray(d.init_value)||(d.init_value=[d.init_value]),$.isFunction(d.event_scroll)||(d.event_scroll=null),$.isFunction(d.event_show)||(d.event_show=null);var m,h,o,f,p=d.item_height*d.item_number,_=d.item_height*Math.floor(d.item_number/2),k=!1,u=0,c=[],v=[],b=[],g=[],x=[],C=0,w=0,Y=!0,a=function(e){e.preventDefault();var a=$(this);(Y||h===a.index())&&(k=!0,o=e.touches?e.touches[0].pageY-a.offset().top:e.pageY-a.offset().top,A.addClass("full"),a.addClass("full"),h=a.index(),m=c[h].removeClass("animation"),f=b[h],w=o,C=Date.now(),Y=!0)},t=function(e){if(k){var a=$(this),t=(a.height()-p)/2,i=e.touches?e.touches[0].pageY-a.offset().top-t:e.pageY-a.offset().top-t,n=i-o;if(f=b[h]+n,_<f)f=_+(l=f-_)/10;else if(f<d.item_height*(Math.floor(d.item_number/2)+1-g[h])){var l=d.item_height*(Math.floor(d.item_number/2)+1-g[h])-f;f=d.item_height*(Math.floor(d.item_number/2)+1-g[h])-l/10}m.css({"webkit-transform":"translateY("+f+"px) translateZ(0)",transform:"translateY("+f+"px) translateZ(0)"}).children(".pick-item.checked").removeClass("checked");var s=Date.now();Y=!0,300<s-C&&(C=s,w=i)}},i=function(e){if(k){var n,a=$(this),t=(a.height()-p)/2,i=e.changedTouches?e.changedTouches[0].pageY-a.offset().top-t:e.pageY-a.offset().top-t,l=Date.now(),s=(i-w)/(l-C);k=Y=!1,A.removeClass("full"),a.removeClass("full"),r=l,u=f,v=6e-4*(c=0<(o=s)?-1:1),function e(){if(!Y){var a=Date.now()-r,t=o+a*v;if(0<=c*t||_<f||f<d.item_height*(Math.floor(d.item_number/2)+1-g[h])){if(_<f)n=0;else if(f<d.item_height*(Math.floor(d.item_number/2)+1-g[h]))n=g[h]-1;else{var i=_-f;n=Math.floor(i/d.item_height),i%d.item_height*2>=d.item_height&&n++}return m.addClass("animation"),y(h,n),void(Y=!0)}f=u+(o+t)/2*a,b[h]=f,m.css({"webkit-transform":"translateY("+f+"px) translateZ(0)",transform:"translateY("+f+"px) translateZ(0)"}),setTimeout(e,10)}}()}var o,r,u,c,v},y=function(e,a){var t=d.item_height*(Math.floor(d.item_number/2)-a),i=c[e].css({"webkit-transform":"translateY("+t+"px) translateZ(0)",transform:"translateY("+t+"px) translateZ(0)"});if(setTimeout(function(){m.removeClass("animation")},400),x[e].index==a)i.find(".pick-item:eq("+a+")").addClass("checked").siblings().removeClass("checked");else{b[e]=t;var n=i.find(".pick-item:eq("+a+")").addClass("checked").siblings().removeClass("checked").end(),l=e+1;if(x[e]={name:n.text(),value:n.data("value"),index:a},!$.isArray(d.data)){for(;;){for(var s=d.data[x[0].value],o=1;o<l;o++)if(o<=e)s=s.value[x[o].value];else{if(d.auto_fill_all){d.fill_all_item[o]?x[o]={name:d.fill_all_item[o].name,value:d.fill_all_item[o].value,index:0}:x[o]={name:"全部",value:0,index:0},s=null;break}for(var r in s.value){x[o]={name:s.value[r].name?s.value[r].name:s.value[r],value:r,index:0},s=s.value[r];break}}if(!s||!s.value||d.active_level&&!(0<d.active_level&&l<d.active_level)){for(o=l;o<u;o++)v[o].remove(),c[o].remove(),v[o]=null,c[o]=null,x[o]=null;break}i=M(s.value,null,l);g[l]=i.len,b[l]=i.translate,x[l]={name:i.found_name,value:i.found_value,index:i.found_index},v[l]||(v[l]=$('<a class="pick-touch" href="javascript:"></a>'),T.append(v[l])),c[l]||(c[l]=$('<div class="pick-list"></div>'),Z.append(c[l])),c[l].html(i.str).css({"webkit-transform":"translateY("+i.translate+"px) translateZ(0)",transform:"translateY("+i.translate+"px) translateZ(0)"}).find(".pick-item:eq("+i.found_index+")").addClass("checked"),l++}u=l}}d.event_scroll&&d.event_scroll(x,e)},M=function(e,a,t){var i,n,l,s="",o=0,r=null;for(var u in d.auto_fill_all&&(n=d.fill_all_item[t]?(s+='<div class="pick-item" data-value="'+d.fill_all_item[t].value+'">'+d.fill_all_item[t].name+"</div>",i=d.fill_all_item[t].name,d.fill_all_item[t].value):(s+='<div class="pick-item" data-value="0">全部</div>',i="全部",0),o++,l=0),e){var c=e[u];"object"===$.type(c)&&(c=c.name),(0===o||a&&a==u)&&(i=c,l=o,e[n=u].value&&(r=u)),s+='<div class="pick-item" data-value="'+u+'">'+c+"</div>",o++}return{str:s,len:o,translate:d.item_height*(Math.floor(d.item_number/2)-l),found_index:l,found_value:n,found_name:i,next_key:r}};function n(){var e,a,t=d.data;if(u=0,c=[],v=[],g=[],b=[],x=[],$.isArray(t))for(var i=t.length;e=M(t[u],d.init_value[u],u),u++,c.push($('<div class="pick-list">'+e.str+"</div>")),v.push($('<a class="pick-touch" href="javascript:"></a>')),g.push(e.len),b.push(e.translate),x.push({name:e.found_name,value:e.found_value,index:e.found_index}),u<i;);else for(;a=(e=M(t,d.init_value[u],u)).next_key,u++,c.push($('<div class="pick-list">'+e.str+"</div>")),v.push($('<a class="pick-touch" href="javascript:"></a>')),g.push(e.len),b.push(e.translate),x.push({name:e.found_name,value:e.found_value,index:e.found_index}),a&&(!d.active_level||0<d.active_level&&u<d.active_level)?t=t[a].value:a=null,a;);Z.html(c),T.html(v);for(var n=0,l=c.length;n<l;n++)c[n].css({width:Math.round(1e4/l)/100+"%","webkit-transform":"translateY("+b[n]+"px) translateZ(0)",transform:"translateY("+b[n]+"px) translateZ(0)"}).find(".pick-item:eq("+x[n].index+")").addClass("checked");d.event_show&&d.event_show(x)}var l=$('<div class="pick-btn-box clearfix"></div>'),s=$('<a class="pick-btn-ok" href="javascript:">确定</a>').on("click",function(){P.hide(),$.isFunction(d.event_ok)&&d.event_ok(x)}),r=$('<a class="pick-btn-cancel" href="javascript:">取消</a>').on("click",function(){P.hide(),$.isFunction(d.event_cancel)&&d.event_cancel(x)}),Z=$('<div class="pick-main"></div>'),j=$('<div class="pick-box"></div>').append(Z.css({height:p,"line-height":d.item_height+"px"}),l.append(r,s)),D=$('<div class="pick-bg"></div>').on("click",function(){P.hide()}),T=$('<div class="pick-touch-box"></div>'),A=$('<div class="pick-touch-wrap"></div>').append(T).height(p).on("touchstart",".pick-touch",a).on("mousedown",".pick-touch",a).on("touchmove",".pick-touch",t).on("mousemove",".pick-touch",t).on("touchend",".pick-touch",i).on("mouseup",".pick-touch",i),F=$('<div class="pick-wrap"></div>').append(D,j,A).on("touchmove",function(e){e.preventDefault(),e.stopPropagation()}),q=$('<div class="datapick"></div>').addClass(d.class);d.node&&(j.prepend($('<div class="pick-node"></div>').append(d.node)),A.addClass("node")),$("body").append(q.append(F)),$.isFunction(d.event_init)&&(n(),d.event_init(x));var P={show:function(e,a){(a||d.data)&&(a&&(d.data=a),e&&$.isArray(e)?d.init_value=e:e&&!$.isArray(e)?d.init_value=[e]:d.init_value=[null],n(),d.cover?q.addClass("pick-cover"):q.removeClass("pick-cover"),q.css("display","block"),setTimeout(function(){q.addClass("open")},50))},hide:function(){q.removeClass("open"),setTimeout(function(){q.css("display","none")},400)}};return P}