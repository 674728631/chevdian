function preview(e){var t,a,l,s,n,r,o,d={container:null,imgs:null,index:1,height:200,dis:50,dely:3500,duration:400,click_close:!0,vertical:!1,fill:"auto",type:"loop",lazyload:!0,number:!1,point:!1,auto:!1,fixed:!0,background:null,event_click:null},c=$.extend({},d,e);null==c.container&&(c.container=$("body"));var i,u,f,p,v,h,g,m,y,b,w,k,x=!1,I=!1,C=0,_=0,j=0,D=0,M=0,z=0,T=0,A=0,X=!1,Y=!1,q=0,F=0,B=0,E={loop:1,single:1,"single-back":1},G=!0,H=!0,J=$('<div class="preview"></div>'),K=L();function L(){if($.isArray(c.imgs)){if($.isArray(c.imgs)&&c.imgs.length<=0)return!1}else c.imgs=[c.imgs];if(1!==E[c.type]&&(c.type=d.type),p=c.fill&&"string"===$.type(c.fill)?'resetImg(this, "'+c.fill+'")':"resetImg(this)",$.isFunction(c.event_click)||(c.event_click=null),o=$.map(c.imgs,function(e){if(e){var t=e.src;return t||"string"!==$.type(e)||(t=e),$('<div class="preview-img"></div>').attr(c.lazyload?"data-src":"src",t).attr({"data-href":e.href?e.href:"","data-default":e.default?e.default:""})}}),r=o.length,n="loop"===c.type?(H=G=!0,s=1,r):(H="single-back"===c.type,G=!1,s=0,r-1),r<=0)return!1;if(1===r)(e=$(o[0])).append($("<img>",{src:e.data("src"),onload:p,onerror:e.data("default")?'setDefaultImg(this, "'+e.data("default")+'")':"javascript:;"}));else if(1<r&&G){var e=$(o[0]),t=$(o[r-1]);o.insertAt(r,e.clone()),o.insertAt(0,t.clone())}for(var a="",i=0;i<r;i++)a+='<a href="javascript:;"></a>';return v=$("<span></span>"),h=$("<span>"+r+"</span>"),g=$('<div class="preview-list"></div>').append(o),m=$('<div class="preview-main"></div>').append(g),y=$('<div class="preview-number"></div>').append(v,"/",h),b=$('<div class="preview-point"></div>').append(a),w=$('<a class="preview-touch" href="javascript:;"></>'),k=$('<div class="preview-bg"></div>'),c.vertical?J.addClass("vertical"):J.removeClass("vertical"),1<r&&(c.vertical?g.css({height:100*o.length+"%"}).find(".preview-img").css({height:Math.round(1e5/o.length)/1e3+"%"}):g.css({width:100*o.length+"%"}).find(".preview-img").css({width:Math.round(1e5/o.length)/1e3+"%"})),_reg_color.test(c.background)&&k.css("background",c.background),("number"!==$.type(c.dis)||c.dis<0)&&(c.dis=d.dis),("number"!==$.type(c.duration)||c.duration<0)&&(c.duration=d.duration),"number"!==$.type(c.dely)&&(c.dely=d.dely),c.dely<c.duration&&(c.dely=c.duration+10),(!/[1-9]+[0-9]*(px|em|rem|%)/i.test(c.height)||"number"===$.type(c.height)&&c.height<=0)&&(c.height=d.height),b.off("click").on("click","a",function(){if(!I){var e=$(this);e.hasClass("on")||(I=!0,c.auto&&f&&(clearInterval(f),f=null),l=e.index()+1,v.text(l),c.lazyload&&R(l),g.animate(c.vertical?{top:100*(1-s-l)+"%"}:{left:100*(1-s-l)+"%"},c.duration),e.addClass("on").siblings().removeClass("on"),setTimeout(function(){c.auto&&1<r&&!f&&(f=setInterval(N,c.dely)),I=!1},c.duration+10))}}),w.off().on({touchstart:O,mousedown:O}).on({touchmove:P,mousemove:P}).on({touchend:Q,mouseup:Q}).on("click",function(){if(!(1<r)){var e=$(o[0]).data("href");e?window.location.href=e:c.event_click&&c.event_click(l-1),c.fixed&&c.click_close&&J.css("display","none")}}),$('<div class="preview-box"></div>').append(k,m,w,b,y)}function N(){x||I||(I=!0,l++,G||r<l&&(l=1),g.animate(c.vertical?{top:100*(1-s-l)+"%"}:{left:100*(1-s-l)+"%"},c.duration),setTimeout(function(){G&&(n<l?l=s:l<=0&&(l=n)),v.text(l),b.children("a").removeClass("on").eq(l-1).addClass("on"),g.css(c.vertical?"top":"left",100*(1-s-l)+"%"),c.lazyload&&R(l),I=!1},c.duration+10))}function O(e){r<=1||I||(e.preventDefault(),w.addClass("full"),x=!0,t=c.container.width(),a=c.container.height(),i=t*(1-s-l),u=a*(1-s-l),C=e.touches?e.touches[0].pageX:e.pageX-w.offset().left,_=e.touches?e.touches[0].pageY:e.pageY-w.offset().top,q=j=C,F=D=_,Y=X=!1,c.auto&&f&&(clearInterval(f),f=null))}function P(e){x&&(q=j,F=D,j=e.touches?e.touches[0].pageX:e.pageX-w.offset().left,D=e.touches?e.touches[0].pageY:e.pageY-w.offset().top,c.vertical?(A=u+(z=D-_),c.fixed,!H&&0<A?A=0:!H&&A<a*(1-r)&&(A=a*(1-r)),g.css("top",A)):(z=_-D,T=i+(M=j-C),A=$(window).scrollTop()+z,c.fixed?X?(!H&&0<T?T=0:!H&&T<t*(1-r)&&(T=t*(1-r)),g.css("left",T)):5<=Math.abs(M)&&(X=!0):X?(!H&&0<T?T=0:!H&&T<t*(1-r)&&(T=t*(1-r)),g.css("left",T)):Y&&($.os.tablet||$.os.phone)?$(window).scrollTop(0<A?A:0):5<=Math.abs(M)?X=!0:5<=Math.abs(z)&&(Y=!0)))}function Q(){if(w.removeClass("full"),!x||!c.fixed&&!c.vertical&&Y&&($.os.tablet||$.os.phone))return x=!1,void(c.auto&&1<r&&!f&&(f=setInterval(N,c.dely)));if(x=!1,B=c.vertical?D-_:j-C,Math.abs(B)<5){var e=$(o[l]).data("href");return e?window.location.href=e:c.event_click&&c.event_click(l-1),void(c.fixed&&c.click_close?J.css("display","none"):c.auto&&!f&&(f=setInterval(N,c.dely)))}Math.abs(B)>c.dis&&(c.vertical?0<B&&0<=D-F&&1-s<l?l--:B<=0&&D-F<=0&&l<=n&&l++:0<B&&0<=j-q&&1-s<l?l--:B<=0&&j-q<=0&&l<=n&&l++),H||(c.vertical||0!==T&&T!==t*(1-r))&&(!c.vertical||0!==A&&A!==a*(1-r))?(i=t*(1-s-l),u=a*(1-s-l),I=!0,g.animate(c.vertical?{top:u}:{left:i},c.duration),setTimeout(function(){G&&(n<l?l=s:l<=0&&(l=n)),v.text(l),b.children("a").removeClass("on").eq(l-1).addClass("on"),g.css(c.vertical?"top":"left",100*(1-s-l)+"%"),c.auto&&!f&&(f=setInterval(N,c.dely)),c.lazyload&&R(l),I=!1},c.duration+10)):c.auto&&!f&&(f=setInterval(N,c.dely))}function R(e){e=e-1+s;var t=$(o[e]);if(0==t.find("img").length&&t.append($("<img>").attr({src:t.data("src"),onload:p,onerror:t.data("default")?'setDefaultImg(this, "'+t.data("default")+'")':"javascript:;"})),0<e&&e<=n)0==(a=$(o[e+1])).find("img").length&&a.append($("<img>").attr({src:a.data("src"),onload:p,onerror:a.data("default")?'setDefaultImg(this, "'+a.data("default")+'")':"javascript:;"})),0==(i=$(o[e-1])).find("img").length&&i.append($("<img>").attr({src:i.data("src"),onload:p,onerror:i.data("default")?'setDefaultImg(this, "'+i.data("default")+'")':"javascript:;"}));else if(0==e){if(0==(a=$(o[e+1])).find("img").length&&a.append($("<img>").attr({src:a.data("src"),onload:p,onerror:a.data("default")?'setDefaultImg(this, "'+a.data("default")+'")':"javascript:;"})),G)0==(i=$(o[n+1])).find("img").length&&i.append($("<img>").attr({src:i.data("src"),onload:p,onerror:i.data("default")?'setDefaultImg(this, "'+i.data("default")+'")':"javascript:;"}))}else{var a,i;if(0==(a=$(o[e-1])).find("img").length&&a.append($("<img>").attr({src:a.data("src"),onload:p,onerror:a.data("default")?'setDefaultImg(this, "'+a.data("default")+'")':"javascript:;"})),G)0==(i=$(o[0])).find("img").length&&i.append($("<img>").attr({src:i.data("src"),onload:p,onerror:i.data("default")?'setDefaultImg(this, "'+i.data("default")+'")':"javascript:;"}))}}return K&&(J.append(K),K=null),J.appendTo(c.container),{show:function(e){$.extend(c,e);var t=L();t?(J.empty().append(t),t=null,J.css({height:c.height,display:"block"}),(l=c.index)<1?l=1:r<l&&(l=r),v.text(l),c.point&&1<r?b.css("display","block"):b.css("display","none"),c.number?y.css("display","block"):y.css("display","none"),c.fixed?J.addClass("fixed"):J.removeClass("fixed"),1<r&&(c.vertical?g.css("top",100*(1-s-l)+"%"):g.css("left",100*(1-s-l)+"%"),c.auto&&!f&&(f=setInterval(N,c.dely)),c.lazyload&&R(l)),b.children("a").removeClass("on").eq(l-1).addClass("on")):console.error("无有效图片")},hide:function(){J.css("display","none"),c.auto&&f&&(clearInterval(f),f=null)}}}